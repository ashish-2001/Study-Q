generator client {
    provider      = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
}

model Course {
    id               Int              @id @default(autoincrement())
    appxCourseId     String
    title            String
    imageUrl         String
    description      String
    openToEveryOne   Boolean          @default(false)
    slug             String
    content          CourseContent[]  
    purchasedBy      UserPurchases[]
}

model UserPurchases {
    user         User      @relation(fields: [userId], references: [id])
    userId       String
    course       Course    @relation(fields: [courseId], references: [id])
    courseId     Int
    assignedAt   DateTime  @default(now())

    @@id([userId, courseId])
}

model Content {
    id              Int                @id @default(autoincrement())     
    type            String             @default("folder")
    title           String        
    hidden          Boolean            @default(false)
    description     String?
    thumbnail       String?
    parentId        Int?
    parent          Content            @relation("ContentToContent", fields: [parentId], references: [id])
    videoProgress   VideoProgress[]
    children        Content[]          @relation("ContentTOContent")
    courses         CourseContent      
    createdAt       DateTime           @default(now())
    VideoMetaData   VideoMetaData?
    NotionMetaData  NotionMetaData?    
    notionMetaData  Int?
    comments        Comment[]
    commentsCount   Int                 @default(0)
    bookmark        Bookmark[]
}

model CourseContent {
    course      Course   @relation(fields: [courseId], references: [id])
    courseId    Int
    content     Content  @relation(fields: [contentId], references: [id])
    contentId   Int

    @@id([courseId, contentId])
}

model NotionMetaData {
    id           Int       @id @default(autoincrement())
    contentId    Int
    content      Content   @relation(fields: [contentId], references: [id])
    notionId     String

    @@unique([contentId])
}

model VideoMetaData {
    id                   Int              @id @default(autoincrement())
    contentId            Int
    appxVideoId          String?
    appxVideoJson        Json?
    video_1080_mp4_1     String?
    video_1080_mp4_2     String?
    video_1080_mp4_3     String?
    video_1080_mp4_4     String?
    video_1080p_1        String?
    video_1080p_2        String?
    video_1080p_3        String?
    video_1080p_4        String?
    video_720p_mp4_1     String?
    video_720p_mp4_2     String?
    video_720p_mp4_3     String?
    video_720p_mp4_4     String?
    video_720p_1         String?
    video_720p_2         String?
    video_720p_3         String?
    video_720p_4         String?
    video_360p_mp4_1     String?
    video_360p_mp4_2     String?
    video_360p_mp4_3     String?
    video_360p_mp4_4     String?
    video_360p_1         String?
    video_360p_2         String?
    video_360p_3         String?
    video_360p_4         String?
    subtitles            String?
    subtitle_tried       Int                 @default(0)
    segments             Json?
    content              Content             @relation(fields: [contentId],  references: [id])
    slides               String?
    thumbnail_mosiac_url String?
    duration             Int?
    migration_status     MigrationStatus      @default(NOT_MIGRATED)
    migration_pickup_time DateTime?           
    migrated_video_1080p_mp4_1  String?
    migrated_video_360p_mp4_1   String?
    migrated_video_720p_mp4_1   String?
    original_mp4_url            String?
    transcoded                  Boolean       @default(false)

    @@unique([contentId])
}